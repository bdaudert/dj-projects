{% extends "csc_base.html" %}

<meta name="keywords" content="Metadata, graph, coop station, station data, historic data,application, product, tool">
<meta name="description" content="SW-CKN Generates Metadata graph for a coop station">

{%load my_scenic_filters%}

{% block content %}

<p align="center">You are here
    <a href="{{HOME_URL}}">Home></a>
    <a href="{{TOOLS_URL}}">Data Analysis></a>
    <a href="{{TOOLS_STATION_URL}}">Station Data Tools></a> 
    <a href="{{SODSUMM_URL}}">Monthly/Seasonal Averages/Extremes and Bar Charts</a></p>

<script type="text/javascript">set_autofill("US_station_id");</script>
<script type="text/javascript">
$(function(){
        //On form change, hide results and form errors
        hide_errors_results_on_change('form1');
});
</script>

<table cellpadding="10">
<td valign="top" width="25%">
    <input type="submit" value="Start Over" onclick="window.location='{{SODSUMM_URL}}'"/>
    <div id='form1'>
        <form method="post" id='form1' action="" onsubmit="show_loading()">{% csrf_token %}
        <table class="form" bgcolor="#CCE0E0">
        {%for field in form1 %}
        {%if not field.is_hidden%}
        {%if user_params_dict.station_id and field.label == "Station id"%}
        <tr bgcolor="#FFEFD5">
        {%elif user_params_dict.start_year and field.label == "Start year"%}
        <tr bgcolor="#FFEFD5">
        {%elif user_params_dict.end_year and field.label == "End year"%}
        <tr bgcolor="#FFEFD5">
        {%else%}
        <tr>
        {%endif%}
        {%if field.label == "Station id" and not user_params_dict.station_id%}
            <td>Station ID/Name</td>
            <td><input autocomplete="off" type="text" size="20" id="station_id" name="station_id" value="{{field.value}}" list="US_station_id"></td>
        {%else%}
            <td>{{field.label}}: </td>
            <td>{{field}}</td>
        {%endif%}
        <td>
        <img alt="Help" title="Help" src="{{MEDIA_URL}}img/QMark.png" class="trigger">
        <div class="pop-up">{{field.help_text}}</div>
        </td>
        </tr>
        {%if field.label == "Station id" and not user_params_dict.station_id%}
        <tr><td></td><td><a target="_blank" href="{{STATION_FINDER_URL}}">Station Finder</a></td><td></td></tr>
        {%endif%}
        {%endif%}

        {%if field.errors%}
        <tr><td></td><td>{{field.errors}}</td><td></td></tr>
        {%endif%}
        {%endfor%}
        </table>
        <input type="submit" value="Submit" name="form1"/>
        </form>
    </div>
</td>
<td valign="top" width="75%">
    <div style="border:none;background-color:X^H#947e6e;">
        <table>
        <td><div id=tool_info_head></div></td><td><div id="how_to_head"></div></td>
        </table> 
        <script type="text/javascript">                        
            $("#tool_info_head").load("{{HTML_URL}}/Buttons.html .tool_info");
        </script>
        <div id="tool_info" style="display:none;"></div>
        <script type="text/javascript">            
            $("#tool_info").load("{{HTML_URL}}/Docu_SODSUMM.html");
        </script>
        <script type="text/javascript">            
            $("#how_to_head").load("{{HTML_URL}}/Buttons.html .tool_how_to");
        </script>
        <div align="left" id="how_to" style="display:none;">
        <div id="Docu_station_id"></div>
        <script type="text/javascript">                        
        $("#Docu_station_id").load("{{HTML_URL}}/Docu_station_id.html");
        </script>
        <div id="Docu_start_end_year"></div>
        <script type="text/javascript">            
        $("#Docu_start_end_year").load("{{HTML_URL}}/Docu_start_end_year_por.html");
        </script>
        <div id="Docu_summary_sodsumm"></div>
        <script type="text/javascript">            
        $("#Docu_summary_sodsumm").load("{{HTML_URL}}/Docu_summary_sodsumm.html");
        </script>
        <div id="Docu_max_missing_days"></div>
        <script type="text/javascript">            
        $("#Docu_max_missing_days").load("{{HTML_URL}}/Docu_max_missing_days.html");
        </script>
        <div id="Docu_plot_opts"></div>
        <script type="text/javascript">            
        $("#Docu_plot_opts").load("{{HTML_URL}}/Docu_PLOT_OPTS_SODSUMM.html");
        </script>
        </div>

        {%if user_params_list and not results%}
        <div id="user_params_list">
        <p class="message">
        Please use the form on the left to complete your data request.<br />
        Double check your input parameters and fill out the highlighted form fields.<br />
        Submit the form.<br />
        Your Parameters were:<br />
        {%for key_val in user_params_list%}
        <b>{{key_val.0}}</b>: {{key_val.1}}<br />
        {%endfor%}
        </p>
        </div>
        {%endif%} 

        {%if results or graphics%}
        <div class="results">
        <p>
        For monthly and annual mean, thresholds and sums:</br>
        Months with {{max_missing_days}} or more missing days are not considered.</br>
        </p>
        <p class="stronger">Station: ({{station_id}}) {{station_name.0}}</br>
        From Year {{start_year}} To Year {{end_year}}</br>
        </p></br>
        {%endif%}
        
        <input type="hidden" id="json_file" name="json_file" value="{{json_file}}">
        <input type="hidden" id="JSON_URL" name="JSON_URL" value="{{JSON_URL}}">
        <!-- One tab per element -->
        {%if results or graphics%}
        <div class="tabs">
            {%for tab in tab_list%}
            <div class="tab">
            {%if forloop.counter0 == 0%}
            <input type="radio" id={{tab}} name="graphs" checked>
            {%else%}
            <input type="radio" id={{tab}} name="graphs">
            {%endif%}
            <label for={{tab}}>{{tab_names|lookup:forloop.counter0}}</label>
            <div class="tab_content" id={{tab}}>
                {%if graphics%}
                <div id="container{{forloop.counter0}}"style="height:350px;width:90%;"></div>
                    <script type="text/javascript" src="{{ MEDIA_URL }}js/hc-sodsumm.js"></script>
                    <br />
                {%endif%}
                {%if results%}
                <table>
                </td><td>
                <p onClick="printNode('printable_table{{forloop.counter0}}')"><img alt="Print" title="Print" src="{{MEDIA_URL}}img/print_button.png"></p>
                </td><td>
                <p onClick="ShowHide('formDownload{{forloop.counter0}}')"><img alt="Download" title="Download" src="{{MEDIA_URL}}img/download_button.png"></p>
                </td>
                <td>
                <!--Download form-->
                <div id="formDownload{{forloop.counter0}}" class="form" style="display:none;">
                    <form method="post" action="" onsubmit="show_loading()">
                    {% csrf_token %}
                    <table id="tableDownload" bgcolor="#CCE0E0">
                    <tr valign="top">
                    <td>Data Format: </td>
                    <td>
                    <select id="data_format" name="data_format" onchange="set_delimiter(this, 'delim{{forloop.counter0}}');">
                    <option value="clm">Columnar, .txt</option>
                    <option value="dlm">Delimited, .dat</option>
                    <option value="xl" selected>Excel, .xls</option>
                    </select>
                    </td>
                    <td><img alt="Help" title="Help" src="{{MEDIA_URL}}img/QMark.png" class="trigger">
                    <div class="pop-up">
                    <div id="ht_data_format"></div>
                    <script type="text/javascript">                        
                        $("#ht_data_format").load("{{HTML_URL}}/Docu_help_texts.html #ht_data_format");
                    </script>
                    </div>
                    </td>
                    </tr>
                    <!--Only show when format is clm or dlm, don't show if xl-->
                    <tr valign="top" id="delim{{forloop.counter0}}" style="display:none;">
                    <td>Delimiter:</td>
                    <td>
                    <select id="delimiter" name="delimiter">
                    <option value="comma" selected>Comma (,)</option>
                    <option value="tab">Tab (    )</option>
                    <option value="space">Space ( )</option>
                    <option value="colon">Colon (:)</option>
                    <option value="pipe">pipe(|)</option>
                    </select>
                    </td>
                    <td><img alt="Help" title="Help" src="{{MEDIA_URL}}img/QMark.png" class="trigger">
                    <div class="pop-up">
                    <div id="ht_delimiter"></div>
                    <script type="text/javascript">                        
                        $("#ht_delimiter").load("{{HTML_URL}}/Docu_help_texts.html #ht_delimiter");
                    </script>
                    </div>
                    </td>
                    </tr>
                    <tr valign="top">
                    <td>Outputfile Name: </td>
                    <td><input type="text" id="output_file_name" name="output_file_name" value="Output"></td>
                    <td><img alt="Help" title="Help" src="{{MEDIA_URL}}img/QMark.png" class="trigger">
                    <div class="pop-up">
                    <div id="ht_output_file_name"></div>
                    <script type="text/javascript">                        
                        $("#ht_output_file_name").load("{{HTML_URL}}/Docu_help_texts.html #ht_output_file_name");
                    </script>
                    </div>
                    </td>
                    </tr>
                    </table>
                    <input type="hidden" id="json_file" name="json_file" value="{{json_file}}">
                    <input type="hidden" id=tab" name="tab" value="{{tab}}">
                    <input type="submit" value="Submit" name="formDownload{{forloop.counter0}}">
                    </form>
                </div><!--end formDownload-->
                </td>
                </table><!--End table download button/form and print button-->

                <div id="printable_table{{forloop.counter0}}">
                    <table cellspacing="2">
                    {%if tab != 'pcpn'%}
                    {%if tab != 'snow'%}
                    <p>{{headers|lookup:tab|safe}}&nbsp;&nbsp;</p>
                    {%else%}
                    <p>{{headers.prsn|safe}}&nbsp;&nbsp;</p>
                    {%endif%}<!--end if tab != 'snow'-->
                    {%else%}
                    {{headers.prsn|safe}}
                    {%endif%}<!--end if tab != 'pcpn'-->
                    </table>
                    </br>

                    <table cellspacing="2">
                    {%if tab != 'pcpn'%}
                    {%if tab != 'snow'%}
                    {%for row in results|lookup:tab%}
                    {%if row.0 == "An"%}
                    <tr><td></td></tr>
                    {%endif%}<!--end if row.0 == "An"-->
                    <tr>{%for val in row%}
                    {%if forloop.counter0 == 0%}
                    <td align="left">{{val}}</td>
                    {%else%}
                    <td align="right">{{val}}</td>
                    {%endif%}
                    {%endfor%}</tr>
                    {%endfor%} <!--end for row in results|lookup:tab-->
                    {%else%}
                    {%for row in results.prsn%}
                    {%if row.0 == "An"%}
                    <tr><td></td></tr>
                    {%endif%}<!--end if row.0 == "An"-->
                    <tr>{%for val in row%}
                    {%if forloop.counter0 == 0%}
                    <td align="left">{{val}}</td>
                    {%else%}
                    <td align="right">{{val}}</td>
                    {%endif%}
                    {%endfor%}</tr>
                    {%endfor%}<!--end for row in results.prsn-->
                    {%endif%}<!--end if tab != 'snow'-->
                    {%else%}
                    {%for row in results.prsn%}
                    {%if row.0 == "An"%}
                    <tr><td></td></tr>
                    {%endif%}
                    <tr>{%for val in row%}
                    {%if forloop.counter0 == 0%}
                    <td align="left">{{val}}</td>
                    {%else%}
                    <td align="right">{{val}}</td>
                    {%endif%}
                    {%endfor%}</tr>
                    {%endfor%}
                    {%endif%} <!--end if tab != 'pcpn'-->
                    </table>
                </div><!--printable table -->
                {%endif%}<!--end if results-->
            </div><!--End Tab content-->
            </div><!--End Tab-->
            {%endfor%} <!--end for tab in tab_list-->
        </div><!--end tabs -->
        </div>
        {%else%} <!--no results and no graphics-->
        {%if run_done%}
        <div class="results">
        <p style="color:red">No data found for these parameters!</p></br>
        </div>
        {%endif%}
        {%endif%}<!--if results or graphics-->
</td><!-- end center-->
</table>
{%endblock%}
