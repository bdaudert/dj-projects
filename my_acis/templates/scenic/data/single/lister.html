{% extends "csc_base.html" %}
<meta name="keywords" content="data, station data, historic data, acis">
<meta name="description" content="SCENIC Historic Station Data">

{%load my_scenic_filters%}

{% block content %} 
<!--
<p align="center">You are here
<a href="{{HOME_URL}}">Home></a>
<a href="{{DATA_URL}}">Data></a>
<a href="{{STATION_DATA_URL}}">Historic Station Data Lister</a></p>
-->

<!--Documentation-->
    <div class="docu" id="tool_info" style="display:none;"></div>
    <script type="text/javascript">                        
        $("#tool_info").load("{{HTML_URL}}/Docu_About_single_lister.html");
    </script>
    <div id="how_to" style="display:none;">
    <div id="Doc_select_stations_by"></div>
    <script type="text/javascript">            
        $("#Doc_select_stations_by").load("{{HTML_URL}}/Docu_select_stations_by.html");
    </script>
    <div id="Docu_elements"></div>
     <script type="text/javascript">            
        $("#Docu_elements").load("{{HTML_URL}}/Docu_elements_station.html");
    </script>
    <div id="Docu_add_degree_days"></div>
    <script type="text/javascript">            
        $("#Docu_add_degree_days").load("{{HTML_URL}}/Docu_add_degree_days.html");
    </script>
    <div id="Docu_degree_days"></div>
    <script type="text/javascript">            
        $("#Docu_degree_days").load("{{HTML_URL}}/Docu_degree_days.html");
    </script>
    <div id="Docu_units"></div>
    <script type="text/javascript">            
        $("#Docu_units").load("{{HTML_URL}}/Docu_units.html");
    </script>
    <div id="Docu_start_end_date"></div>
     <script type="text/javascript">            
        $("#Docu_start_end_date").load("{{HTML_URL}}/Docu_start_end_date.html");
    </script>
    <div id="Docu_show_flags"></div>
    <script type="text/javascript">            
        $("#Docu_show_flags").load("{{HTML_URL}}/Docu_show_flags.html");
    </script>
    <div id="Docu_show_observation_time"></div>
    <script type="text/javascript">            
        $("#Docu_show_observation_time").load("{{HTML_URL}}/Docu_show_observation_time.html");
    </script>
    <div id="Docu_date_format"></div>
    <script type="text/javascript">            
        $("#Docu_date_format").load("{{HTML_URL}}/Docu_date_format.html");
    </script>
    <div id="Docu_data_format"></div>
    <script type="text/javascript">            
        $("#Docu_data_format").load("{{HTML_URL}}/Docu_data_format.html");
    </script>
    <div id="Docu_delimiter"></div>
    <script type="text/javascript">
        $("#Docu_delimiter").load("{{HTML_URL}}/Docu_delimiter.html");         
    </script>
    </div><!--how_to-->

<!---Hidded variables-->

<!--Set up autofill-->
<script type="text/javascript">set_autofill("US_station_id");</script>
<!--On form change, hide results and form errors-->
<script type="text/javascript">
$(function(){
    //On form change, hide results and form errors
    hide_errors_results_on_change('tableDataForm');
});
</script>

<table>
<td valign="bottom" width="300px">
    <input type="submit" value="Start Over" onclick="window.location='{{DATA_URL}}single/lister/'"/>
</td>
<td valign="top" width="650px" align="left">
    <table>
    <td><div id=tool_info_head></div></td>
    <td><div id="how_to_head"></div></td>
    </table>
    <script type="text/javascript">                        
        $("#tool_info_head").load("{{HTML_URL}}/Buttons.html .tool_info");
    </script>
    <script type="text/javascript">            
        $("#how_to_head").load("{{HTML_URL}}/Buttons.html .tool_how_to");
    </script>
</td>
</table>


<table>
<td valign="top">
    <div id='formData'>
        <form method="post" id="tableDataForm" action="" onsubmit="show_loading();">{% csrf_token %}
        <table class="form" id="tableData1" frame="void" style="border-collapse:collapse;">
        <tr valign="bottom">
        <td>Point of Interest:</td>
        <td>
            <select id="select_point" name="select_point" onchange="set_station_or_location(this) & update_value(this.value);">
            <option value="none" {{checkbox_vals.station_selected}}></option>
            <option value="station_id" {{checkbox_vals.station_selected}}>Station</option>
            <option value="location" {{checkbox_vals.location_selected}}>Gridpoint (Lon/Lat)</option>
            </select>
        </td>
        <td>
            <img alt="Help" title="Help" src="{{MEDIA_URL}}img/QMark.png" class="trigger">
            <div class="pop-up">
            <div id="ht_select_point"></div>
            <script type="text/javascript">                        
            $("#ht_select_point").load("{{HTML_URL}}/Docu_help_texts.html #ht_select_point");
            </script>
            </div>  
        </td>
        </tr>
        <tr class="station" style="display:none;">{% include 'includes/station_id.html'%}</tr>
        <tr class="station" style="display:none;">{% include 'includes/station_finder.html'%}</tr>
        <tr class="location" style="display:none;">{% include 'includes/location.html'%}</tr>
        <tr class="station" style="display:none;">{% include 'includes/station_elements.html'%}</tr>
        <tr class="location" style="display:none;">{% include 'includes/grid_elements.html'%}</tr>
        </table>
        <input type="hidden" id="overlay_state" name="overlay_state" value="{{initial.overlay_state}}">
        <input style="margin:5px" type="submit" value="Get data" name="formData"/>
        </form>
    </div>
</td>
<td valign="top">
    <!--Map section-->
    <div id="PolyMap" style="display:none;">
        <div id="map-polygon"></div>
        <div id="panel">
        <div id="color-palette"></div>
            <div>
                <button id="delete-button">Delete Selected Shape</button>
            </div>
        </div>
        <br />
        {%if lat and lon %}
        <input type="hidden" id="initial_lat" name="initial_lat" value={{lat}}>
        <input type="hidden" id="initial_lon" name="initial_lon" value={{lon}}>
        {%else%}
        <input type="hidden" id="initial_lat" name="initial_lat" value='34.5'>
        <input type="hidden" id="initial_lon" name="initial_lon" value='-114.5'>
        {%endif%}
    </div>

    <div id="GridpointMap" style="display:none;"></div>

    {%if need_overlay_map%}
    <div id="OverlayMap" style="display:block;">
    {%else%}
    <div id="OverlayMap" style="display:none;">
    {%endif%}
         <div id="formOverlay" style="display:inherit;">
            <form method="post" action="" onsubmit="show_loading() & set_hidden_fields(this,'tableDataForm')">{% csrf_token %}
            <table class="form" style="margin:0px;">
            <td>State: </td>
            <td>
                <select name="overlay_state" id="overlay_state">
                <option value="al" {{al_selected}}>Alabama</option>
                <option value="ak" {{ak_selected}}>Alaska</option>
                <option value="az" {{az_selected}}>Arizona</option>
                <option value="ar" {{ar_selected}}>Arkansas</option>
                <option value="ca" {{ca_selected}}>California</option>
                <option value="co" {{co_selected}}>Colorado</option>
                <option value="ct" {{ct_selected}}>Connecticut</option>
                <option value="de" {{de_selected}}>Delaware</option>
                <option value="dc" {{dc_selected}}>District of Columbia</option>
                <option value="fl" {{fl_selected}}>Florida</option>
                <option value="ga" {{ga_selected}}>Georgia</option>
                <option value="hi" {{hi_selected}}>Hawaii</option>
                <option value="id" {{id_selected}}>Idaho</option>
                <option value="il" {{il_selected}}>Illinois</option>
                <option value="in" {{in_selected}}>Indiana</option>
                <option value="ia" {{ia_selected}}>Iowa</option>
                <option value="ks" {{ks_selected}}>Kansas</option>
                <option value="ky" {{ky_selected}}>Kentucky</option>
                <option value="la" {{la_selected}}>Louisiana</option>
                <option value="me" {{me_selected}}>Maine</option>
                <option value="md" {{md_selected}}>Maryland</option>
                <option value="ma" {{ma_selected}}>Massachusetts</option>
                <option value="mi" {{mi_selected}}>Michigan</option>
                <option value="mn" {{mn_selected}}>Minnesota</option>
                <option value="ms" {{ms_selected}}>Mississippi</option>
                <option value="mo" {{mo_selected}}>Missouri</option>
                <option value="mt" {{mt_selected}}>Montana</option>
                <option value="ne" {{ne_selected}} >Nebraska</option>
                <option value="nv" {{nv_selected}}>Nevada</option>
                <option value="nh" {{nh_selected}}>New Hampshire</option>
                <option value="nj" {{nj_selected}}>New Jersey</option>
                <option value="nm" {{nm_selected}}>New Mexico</option>
                <option value="ny" {{ny_selected}}>New York</option>
                <option value="nc" {{nc_selected}}>North Carolina</option>
                <option value="nd" {{nd_selected}}>North Dakota</option>
                <option value="oh" {{oh_selected}}>Ohio</option>
                <option value="ok" {{ok_selected}}>Oklahoma</option>
                <option value="or" {{or_selected}}>Oregon</option>
                <option value="pa" {{pa_selected}}>Pennsylvania</option>
                <option value="ri" {{ri_selected}}>Rhode Island</option>
                <option value="sc" {{sc_selected}}>South Carolina</option>
                <option value="sd" {{sd_selected}}>South Dakota</option>
                <option value="tn" {{tn_selected}}>Tennessee</option>
                <option value="tx" {{tx_selected}}>Texas</option>
                <option value="ut" {{ut_selected}}>Utah</option>
                <option value="vt" {{vt_selected}}>Vermont</option>
                <option value="va" {{va_selected}}>Virginia</option>
                <option value="wa" {{wa_selected}}>Washington</option>
                <option value="wv" {{wv_selected}}>West Virginia</option>
                <option value="wi" {{wi_selected}}>Wisconsin</option>
                <option value="wy" {{wy_selected}}>Wyoming</option>
            </select>
            </td>
            <td><input type="submit" value="Update Map" name="formOverlay"/></td>
            </tr>
            </table>
            <input type="hidden" value="{{initial.select_stations_by}}" name="select_overlay_by" id="select_overlay_by">
            <input type="hidden" value="{{area_type_value}}" name="{{area_type}}">
            <input type="hidden" id="elements_string" value="{{initial.elements_string}}" name="elements" class="elements_string">
            </form>
        </div>
    </div>

    {%if need_overlay_map%}
    {%if overlay_error%}
    <p class="error">{{overlay_error}}</p>
    {%else%}
    <div id="map-overlay"></div>
    <div id="content-window"></div>
    <script type="text/javascript">initialize_map_overlays("{{area_type}}","{{host}}", "{{kml_file_path}}")</script>
    {%endif%}
    <br /><br /> 
    {%endif%}
  
    <!--Errors and search parameter section-->
    {%if form_error%}
    <div id="form_error">
        <p class="error">ERROR: Please correct the form error(s) highlighted in red!</p>
        {%for key, val in form_error.items%}
            <script type="text/javascript">highlight_form_field("{{key}}","{{val}}")</script>
        {%endfor%}
    </div>
    {%endif%}
 
    <div class="results">
    {%if form_message%}
    <div class="results" id="user_params_list">
    <p class="message">
    Additional format changes can be made using the form on the left!<br />
    {%if form_message_sf %}
    Please check your parameters and click on "Get Data" to obtain your data.<br /><br />
    {%endif%}
    YOUR SEARCH PARAMETERS:<br />
    {%for key_val in user_params_list%}
    <b>{{key_val.0}}</b>:
    {%if key_val.0 == "Station IDs" %}
    <span id="stn_list" class="message"></span><br />
    {%else%}
    {{key_val.1}}<br />
    {%endif%}
    {%endfor%}
    </p>
    </div>
    {%endif%}

    {%if large_request %}
    <p class="message">{{large_request}}</p>
    {%endif%}

    {%if too_large%}
    <p class="error">{{too_large}}</p>
    {%endif%}

    {%if display_params_list and not form_message%}
    <p class="message"><b>YOUR SEARCH PARAMETERS</b>:<br /><br />
    {%for param in display_params_list%}
    {%if param.0 and param.1%}
    <b>{{param.0}}</b>:
    {%if param.0 == "Elements"%}
    <br />
    {%for el in params_dict.elems_long%}
    {{el}}<br />
    {%endfor%}
    {%elif param.0 == "shape"%}
    <p class="message" onClick="ShowHide('coords')"><u>Click here to see/hide coordinates</u></p>
    <div id="coords" style="display:none;">{{params.1}}</div>
    {%elif param.0 == "Station IDs"%}
    {%for ID in params_dict.station_list%}
    {{ID}}
    {%if not forloop.last%},{%endif%}
    <br />
    {%endfor%}
    {%else%}
    {{param.1}}<br />
    {%endif%}
    {%endif%}
    {%endfor%}
    {%endif%}
    </p></div>

    <div class="results">
    {%if results%}
    {%if results.error%}
    <p class="error">{{results.error}}</p>
    {%else%}
    <div id="Arrow" class="results">
    <table style="display:block;">
    <td valign="top"><b>RESULTS:</b></td><td>
    <td><img alt="DownArrow" src="{{MEDIA_URL}}img/DownArrow.png" height="200px"></td>
    </table>
    </div>
    {%endif%}
    </div>
</td></table>

<table cellpadding="10" align="center">
<td valign="top" width="97%">
    <div class="results">
    {%if results%}
    <!--Download data button-->
    <p onClick="ShowHide('formDownload')"><img alt="Download" title="Download" src="{{MEDIA_URL}}img/download_button.png"></p>
    <!--Download form-->
    <div id="formDownload" class="form" style="display:none;">
        {%if json_dict%}
        <form method="post" action="?json_file={{json_dict.json_file}}" onsubmit="show_loading()">
        {%elif json_file%}
        <form method="post" action="?json_file={{json_file}}" onsubmit="show_loading()">
        {%else%}
        <form method="post" action="" onsubmit="show_loading()">
        {%endif%}
        {% csrf_token %}
        <table id="tableDownload" >
        <tr valign="top">
        <td>Data Format: </td>
        <td>
        <select id="data_format_download" name="data_format_download" onchange="set_delimiter(this, 'delim_download');">
        <option value="clm">Columnar, .txt</option>
        <option value="dlm">Delimited, .dat</option>
        <option value="xl" selected>Excel, .xls</option>
        </select>
        </td>
        <td><img alt="Help" title="Help" src="{{MEDIA_URL}}img/QMark.png" class="trigger">
        <div class="pop-up">
        <div id="ht_data_formati_download"></div>
        <script type="text/javascript">                        
            $("#ht_data_format_download").load("{{HTML_URL}}Docu_help_texts.html #ht_data_format");
        </script>
        </div>
        </td>
        </tr>
        <!--Only show when format is clm or dlm, don't show if xl-->
        <tr valign="top" id="delim_download" style="display:none;">
        <td>Delimiter:</td>
        <td>
        <select id="delimiter_download" name="delimiter_download">
        <option value="comma" selected>Comma (,)</option>
        <option value="tab">Tab (    )</option>
        <option value="space">Space ( )</option>
        <option value="colon">Colon (:)</option>
        <option value="pipe">pipe(|)</option>
        </select>
        </td>
        <td><img alt="Help" title="Help" src="{{MEDIA_URL}}img/QMark.png" class="trigger">
        <div class="pop-up">
        <div id="ht_delimiter_download"></div>
        <script type="text/javascript">                        
            $("#ht_delimiter_download").load("{{HTML_URL}}Docu_help_texts.html #ht_delimiter");
        </script>
        </div>
        </td>
        </tr>
        <tr valign="top">
        <td>Output file name: </td>
        <td><input type="text" id="output_file_name_download" name="output_file_name_download" value="Output"></td>
        <td><img alt="Help" title="Help" src="{{MEDIA_URL}}img/QMark.png" class="trigger">
        <div class="pop-up">
        <div id="ht_output_file_name_download"></div>
        <script type="text/javascript">                        
            $("#ht_output_file_name_download").load("{{HTML_URL}}Docu_help_texts.html #ht_output_file_name");
        </script>
        </div>
        </td>
        </tr>
        </table>
        <input type="hidden" id="json_file" name="json_file" value="{{json_file}}">
        <input type="submit" value="Download" name="formDownload">
        </form>
     </div><!--end formDownload-->


    <!--Link to relevant apps-->
    {%if link_to_all and not results.error%}
    <a target="_blank" href="{{STATION_SODXTRMTS_URL}}?{%for key,val in sodxtrmts_params_dict.items%}{{key}}={{val}}{%if not forloop.last%}&{%endif%}{%endfor%}"><font size="3">Generate custom statistics and time series!</font></a><br />
    <a target="_blank" href="{{STATION_SODSUMM_URL}}?{%for key,val in sodsumm_params_dict.items%}{{key}}={{val}}{%if not forloop.last%}&{%endif%}{%endfor%}"><font size="3">Generate station climatology!</font></a><br />
    <a target="_blank" href="{{STATION_MON_AVES_URL}}?{%for key,val in monthly_aves_params_dict.items%}{{key}}={{val}}{%if not forloop.last%}&{%endif%}{%endfor%}"><font size="3">Generate Barcharts of Monthly Averages</font></a><br />
    {%endif%}
    {%if link_to_mon_aves and not results.error%}
    <a target="_blank" href="{{STATION_MON_AVES_URL}}?{%for key,val in monthly_aves_params_dict.items%}{{key}}={{val}}{%if not forloop.last%}&{%endif%}{%endfor%}"><font size="3">Generate Barcharts of monthly averages</font></a><br />
    {%endif%}
    {%endif%}

    {%if station_ids_error %}
        <div class="error">{{station_ids_error}}</div><br />
    {%endif%}
    
    {%for stn in stn_idx%}
    {%if results.stn_data|lookup:stn%}

    <b>Station Name</b>: {{results.stn_names|lookup:stn|safe}}<br />
    <b>State</b>: {{results.stn_state|lookup:stn|safe}}<br />
    <b>Station ID and Network Pairs</b>:<br /> 
    {%for id_network in results.stn_ids|lookup:stn %}
    {%if forloop.counter|divisibleby:2%}<br />{%endif%}
    {{id_network}}
    {%if not forloop.last%},{%endif%}
    {%endfor%}<br />
    <b>Latitude, Longitude</b>: {{results.stn_lat|lookup:stn|safe}}, {{results.stn_lon|lookup:stn|safe}}<br />
    <b>Elevation</b>: {{results.stn_elev|lookup:stn|safe}} ft<br /><br />
    <b>DATA:</b><br />
    {%if not results.error%}
    ACIS Data Flags: M = Missing, T = Trace, S = Subsequent, A = Accumulated<br />
    {%endif%}
    <div class="error"> {{results.stn_errors|lookup:stn}}</div><br />
    {%if not json%}
    <table border="1">
    <th>date</th>
    {%if params_dict.show_flags == "T"%}
    {%if params_dict.show_observation_time == "T"%}
    {%for el in element_list%}<th>{{params_dict.base_el_dict|lookup:el}}{{params_dict.base_temp_dict|lookup:el}} ({{unit_dict|lookup:el}})</th><th>Flag</th><th>obs time (hr)</th>{%endfor%}
    {%else%}
    {%for el in  element_list%}<th>{{params_dict.base_el_dict|lookup:el}}{{params_dict.base_temp_dict|lookup:el}} ({{unit_dict|lookup:el}})</th><th>Flag</th>{%endfor%}
    {%endif%}
    {%else%}
    {%if params_dict.show_observation_time == "T"%}
    {%for el in element_list%}<th>{{params_dict.base_el_dict|lookup:el}}{{params_dict.base_temp_dict|lookup:el}} ({{unit_dict|lookup:el}})</th><th>obs time (hr)</th>{%endfor%}
    {%else%}
    {%for el in element_list%}<th>{{params_dict.base_el_dict|lookup:el}}{{params_dict.base_temp_dict|lookup:el}} ({{unit_dict|lookup:el}})</th>{%endfor%}
    {%endif%}
    {%endif%}
    </th>
    {%for date_vals in results.stn_data|lookup:stn%}
    <tr>
    {%for el_val in date_vals%}

    {%if forloop.first %}
    <td align="right">{{el_val}}</td>
    {%else%}
    {%if params_dict.show_flags == "T"%}
    {%if params_dict.show_observation_time == "T"%}
    <td align="right">{{el_val|lookup:0}}</td><td align="left">{{el_val|lookup:1}}</td><td align="left">{{el_val|lookup:2}}</td>
    {%else%}
    <td align="right">{{el_val|lookup:0}}</td><td align="left">{{el_val|lookup:1}}</td>
    {%endif%}
    {%else%}
    {%if params_dict.show_observation_time == "T"%}
    {%if el_val|lookup:1 == "T"%}
    <td align="right">T</td><td align="left">{{el_val|lookup:2}}</td>
    {%else%}
    <td align="right">{{el_val|lookup:0}}</td><td align="left">{{el_val|lookup:2}}</td>
    {%endif%}
    {%else%}
    {%if el_val|lookup:1 == "T"%}
    <td align="right">T</td>
    {%else%}
    <td align="right">{{el_val|lookup:0}}</td>
    {%endif%}
    {%endif%}
    {%endif%}
    {%endif%}
    {%endfor%}
    </tr>
    {%endfor%}
    </table>
    <br />
    {%else%}
    {{results.stn_data|lookup:stn}}
    {%endif%}
    {%endif%}<!--End if results.stn_data|lookup:stn-->
    {%endfor%}<!--End station loop-->
    {%endif%}<!--End if results-->
    </div><!--end results div-->
</td></table>
{%endblock%}
