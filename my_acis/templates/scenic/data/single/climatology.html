{% extends "csc_base.html" %}

<meta name="keywords" content="climatology, barchart, coop station, station data, historic data,, gridded data,application, product, tool">
<meta name="description" content="SCENIC Climatology">

{%load my_scenic_filters%}

{% block content %}

<!--Documentation-->
<div class="docu" id="tool_info" style="display:none;">
    {% include 'includes/Docu_app_climatology.html'%}
</div>
<div id="how_to" style="display:none;">
        <div id="Docu_point_of_interest">{% include 'includes/Docu_point_of_interest.html'%}</div>
        <div id="Docu_grids">{% include 'includes/Docu_grids.html'%}</div>
        <div id="Docu_start_end_year">{% include 'includes/Docu_start_end_year.html'%}</div>
        <div id="Docu_climatology_smry_type">{% include 'includes/Docu_climatology_smry_type.html'%}</div>
        <div id="Docu_units">{% include 'includes/Docu_units.html'%}</div>
        <div id="Docu_max_missing_days">{% include 'includes/Docu_max_missing_days.html'%}</div>
        <div id="Docu_plot_opts_climatology">{% include 'includes/Docu_plot_opts_climatology.html'%}</div>
        <script type="text/javascript">            
        $("#Docu_plot_opts").load("{{HTML_URL}}/Docu_PLOT_OPTS_SODSUMM.html");
        </script>
        </div>


<!--Set up autofill-->
{%if initial.autofill_list %}
    <script type="text/javascript">set_autofill("{{initial.autofill_list}}");</script>
{%endif%}

<!--Toolinfo/Howto-->
<table>
<td valign="bottom" width="45%">
    <input type="submit" value="Start Over" onclick="window.location='{{DATA_URL}}single/climatology/'"/>
</td>
<td valign="top" width="55%" align="left">
    <table>
    <tr>
    <td><div id=tool_info_head>{% include 'includes/Button_tool_info.html'%}</div></td>
    <td><div id="how_to_head">{% include 'includes/Button_how_to.html'%}</div></td>
    </tr>
    </table>
</td>
</table>

<table>
<!--Form-->
<td valign="top" width="40%">
    <div id="formData" class="form" style="border:none;">
    <form method="post" id="tableDataForm" action="" onsubmit="show_loading()">{% csrf_token %}
    <table id="tableData" class="form">
    <tr class="station_grid" style="display:table-row" valign="bottom">{% include 'includes/single_select_area.html'%}</tr>
    <tr class="station_grid" style="display:table-row" id="area" valign="bottom">{% include 'includes/area.html'%}</tr>
    {%if initial.data_type == "grid"%}    
    <tr class="grid" id="grid_type" style="display:table-row">{% include 'includes/grids.html'%}</tr> 
    <tr valign="top" id="stn_finder" style="display:none">{% include 'includes/station_finder.html'%}</tr>
    {% else%}
    <tr class="grid" id="grid_type" style="display:none">{% include 'includes/grids.html'%}</tr>
    <tr valign="top" id="stn_finder">{% include 'includes/station_finder.html'%}</tr>
    {%endif%}
    <tr valign="top">{% include 'includes/start_year.html'%}</tr>
    <tr valign="top">{% include 'includes/end_year.html'%}</tr>
    <tr valign="top">{% include 'includes/climatology_summary_type.html'%}</tr>
    <tr valign="top">{% include 'includes/units.html'%}</tr>
    <tr valign="top">{% include 'includes/max_missing_days.html'%}</tr>
    <tr valign="top" id="generate_graph_row" style="display:none">{% include 'includes/climatology_generate_graph.html'%}</tr>
    </table>
    <input type="submit" value="Analyze" name="formData"/>
    </form>
    </div><!--End formData-->
</td>
<!--Errors/dowm arrow/maps-->
<td valign="top" width="60%" align="center">
    {%if form_error%}
    <p class="error" align="left">ERROR: Please correct the form error(s) highlighted in red!</p>
    {%for key, val in form_error.items%}
    <script type="text/javascript">highlight_form_field("{{key}}","{{val}}")</script>
    {%endfor%}
    {%endif%} 

    {%if results%}
    <div id="Arrow" class="results">
    <table align="center">
    <td valign="top"><b>RESULTS:</b></td><td>
    <td><img alt="DownArrow" src="{{MEDIA_URL}}img/DownArrow.png" height="200px"></td>
    </table>
    </div>
    {%endif%}

    {%if run_done and not results%}
        <div class="results">
        <p style="color:red">No data found for these parameters!</p> 
        </div>
    {%endif%}

    <!--Maps-->
    {%if need_gridpoint_map%}
    <div id="GridpointMap" style="display:block">
    <div id="map-gridpoint"></div>
    </div>
    <script type="text/javascript">initialize_grid_point_map();</script> 
    {%else%}
    <div id="GridpointMap" style="display:none"></div>
    {%endif%}
</td><!-- end center-->
</table>

<!--Results-->
<table cellpadding="10" align="center">
<td valign="top" width="97%" align="center">
    {%if results%}
    <div class="results">
        <p>
        For monthly and annual mean, thresholds and sums:</br>
        Months with {{initial.max_missing_days}} or more missing days are not considered.</br>
        </p>
        {% if initial.location%}
        <p class="stronger">Location: ({{initial.location}})</br>
        {%endif%}
        {% if initial.station_id%}
        <p class="stronger">Station: ({{initial.station_id}})</br>
        {%endif%}
        From Year {{start_year}} To Year {{end_year}}</br>
        </p></br>
    </div>
    {%endif%}
      
  
    <input type="hidden" id="json_file" name="json_file" value="{{json_file}}">
    <input type="hidden" id="JSON_URL" name="JSON_URL" value="{{JSON_URL}}">
        
    <!-- TAB results -->
    {%if results%}
    <div class="results">
    <div class="tabs">
    {%for tab in tab_list%}
        <div class="tab">
        {%if forloop.counter0 == 0%}
        <input type="radio" id={{tab}} name="graphs" checked>
        {%else%}
        <input type="radio" id={{tab}} name="graphs">
        {%endif%}
        <label for={{tab}}>{{tab_names|lookup:forloop.counter0}}</label>
        <div class="tab_content" id={{tab}}>
            <div id="container{{forloop.counter0}}"style="height:350px;width:90%;"></div>
            <script type="text/javascript" src="{{ MEDIA_URL }}js/hc-sodsumm.js"></script>
            <br />
            <table>
            </td><td>
            <p onClick="printNode('printable_table{{forloop.counter0}}')"><img alt="Print" title="Print" src="{{MEDIA_URL}}img/print_button.png"></p>
            </td><td>
            <p onClick="ShowHide('formDownload{{forloop.counter0}}')"><img alt="Download" title="Download" src="{{MEDIA_URL}}img/download_button.png"></p>
            </td>
            <td>
            <!--Download form-->
            <div id="formDownload{{forloop.counter0}}" class="form" style="display:none;">
                {% include 'includes/climatology_download_form.html'%}
            </div>
            </td>
            </table><!--End table download button/form and print button-->

            <div id="printable_table{{forloop.counter0}}">
                <table cellspacing="2">
                {%if tab != 'pcpn'%}
                {%if tab != 'snow'%}
                <p>{{headers|lookup:tab|safe}}&nbsp;&nbsp;</p>
                {%else%}
                <p>{{headers.prsn|safe}}&nbsp;&nbsp;</p>
                {%endif%}<!--end if tab != 'snow'-->
                {%else%}
                {{headers.prsn|safe}}
                {%endif%}<!--end if tab != 'pcpn'-->
                </table>
                </br>

                <table cellspacing="2">
                {%if tab != 'pcpn'%}
                {%if tab != 'snow'%}
                {%for row in results|lookup:tab%}
                {%if row.0 == "An"%}
                <tr><td></td></tr>
                {%endif%}<!--end if row.0 == "An"-->
                <tr>{%for val in row%}
                {%if forloop.counter0 == 0%}
                <td align="left">{{val}}</td>
                {%else%}
                <td align="right">{{val}}</td>
                {%endif%}
                {%endfor%}</tr>
                {%endfor%} <!--end for row in results|lookup:tab-->
                {%else%}
                {%for row in results.prsn%}
                {%if row.0 == "An"%}
                <tr><td></td></tr>
                {%endif%}<!--end if row.0 == "An"-->
                <tr>{%for val in row%}
                {%if forloop.counter0 == 0%}
                <td align="left">{{val}}</td>
                {%else%}
                <td align="right">{{val}}</td>
                {%endif%}
                {%endfor%}</tr>
                {%endfor%}<!--end for row in results.prsn-->
                {%endif%}<!--end if tab != 'snow'-->
                {%else%}
                {%for row in results.prsn%}
                {%if row.0 == "An"%}
                <tr><td></td></tr>
                {%endif%}
                <tr>{%for val in row%}
                {%if forloop.counter0 == 0%}
                <td align="left">{{val}}</td>
                {%else%}
                <td align="right">{{val}}</td>
                {%endif%}
                {%endfor%}</tr>
                {%endfor%}
                {%endif%} <!--end if tab != 'pcpn'-->
                </table>
            </div><!--printable table -->
        </div><!--End Tab content-->
    </div><!--End Tab-->
    {%endfor%} <!--end for tab in tab_list-->
    </div><!--end tabs -->
    </div><!--end div results-->
{%endif%}<!--if results or graphics-->
</td></table>
{%endblock%}
