{% extends "csc_base.html" %}
<meta name="keywords" content="data, station data, gridded data, modeled data, acis">
<meta name="description" content="SCENIC Multi point data lister">

{%load my_scenic_filters%}

{% block content %} 

<!--Documentation-->
<div class="docu" id="tool_info" style="display:none;">
    {% include 'includes/Docu_app_multi_lister.html'%}
</div>
<div id="how_to" style="display:none;">
    <div id="Docu_area_of_interest">{% include 'includes/Docu_area_of_interest.html'%}</div>
    <div id="Docu_data_type">{% include 'includes/Docu_data_type.html'%}</div>
    <div id="Docu_grids">{% include 'includes/Docu_grids.html'%}</div>
    <div id="Docu_temporal_resolution">{% include 'includes/Docu_temporal_resolution.html'%}</div>
    <div id="Docu_elements">{% include 'includes/Docu_elements.html'%}</div>
    <div id="Docu_add_degree_days">{% include 'includes/Docu_add_degree_days.html'%}</div>
    <div id="Docu_degree_days">{% include 'includes/Docu_degree_days.html'%}</div>
    <div id="Docu_units">{% include 'includes/Docu_units.html'%}</div>
    <div id="Docu_start_end_date">{% include 'includes/Docu_start_end_date.html'%}</div>
    <div id="Docu_data_summary">{% include 'includes/Docu_data_summary.html'%}</div>
    <div id="Docu_show_flags">{% include 'includes/Docu_show_flags.html'%}</div>
    <div id="Docu_show_observation_time">{% include 'includes/Docu_show_observation_time.html'%}</div>
    <div id="Docu_data_format">{% include 'includes/Docu_data_format.html'%}</div>
    <div id="Docu_delimiter">{% include 'includes/Docu_delimiter.html'%}</div>
</div><!--End how_to-->

<!---Hidden variables-->
<input type="hidden" id="app_name" name="app_name" value="multi_lister">
<!--For maps-->
<input type="hidden" id="host" name="host" value="{{initial.host}}">
<input type="hidden" id="kml_file_path" name="kml_file_path" value="{{initial.kml_file_path}}">


<!--Set up autofill-->
<script type="text/javascript">set_autofill("{{initial.autofill_list}}");</script>

<!--Tool Info/Howto-->
<table>
<td valign="bottom" width="45%">
    <input type="submit" value="Start Over" onclick="window.location='{{DATA_URL}}multi/lister/'"/>
    {%if results.data or results.smry%}
        <input type="submit" value="Change Options" onclick="ShowHideTopOfPage()">
    {%endif%}    
</td>
<td valign="top" width="55%" align="left">
    <table>
    <tr>
    <td><div id=tool_info_head>{% include 'includes/Button_tool_info.html'%}</div></td>
    <td><div id="how_to_head">{% include 'includes/Button_how_to.html'%}</div></td>
    </tr>
    </table>
</td>
</table>

<!--Form-->
{% if not results.data and not results.smry%}
    <table id="top_of_page">
{%else%}
    <table id="top_of_page" style="display:none">
{%endif%}
<td valign="top" width="40%">
    <div id='formData'>
        <form method="post" id="DataForm" action="" onsubmit="show_loading()">{% csrf_token %}
        <table class="form" id="tableData">
        <tr  style="display:table-row">{% include 'includes/area_select.html'%}</tr>
        <tr  style="display:table-row;" id="area" valign="bottom">{% include 'includes/area.html'%}</tr>
        <tr  style="display:table-row">{% include 'includes/data_type.html'%}</tr>
        {%if initial.data_type == "grid"%}
        <tr  id="grid_type" style="display:table-row">{% include 'includes/grids.html'%}</tr>
        {% if initial.grid == "21"%}
        <tr  id="temp_res" style="display:table-row">{% include 'includes/temporal_resolution.html'%}</tr>
        {%else%}
        <tr  id="temp_res" style="display:none">{% include 'includes/temporal_resolution.html'%}</tr>
        {%endif%}
        {%else%}
        <tr  id="grid_type" style="display:none">{% include 'includes/grids.html'%}</tr>
        <tr  id="temp_res" style="display:none">{% include 'includes/temporal_resolution.html'%}</tr>
        {%endif%}
        <tr  style="display:table-row">{% include 'includes/elements.html'%}</tr>
        <tr  id="add" valign="top" style="display:table-row">{% include 'includes/add_degree_days.html'%}</tr>
       {%if initial.add_degree_days == "T"%}
            <tr id="dd" valign="top" style="display:table-row">{% include 'includes/degree_days.html'%}</tr>
        {%else%}
            <tr id="dd" valign="top" style="display:none">{% include 'includes/degree_days.html'%}</tr>
        {%endif%}
        <tr  style="display:table-row;">{% include 'includes/units.html'%}</tr>
        <tr  style="display:table-row;">{% include 'includes/start_date.html'%}</tr>
        <tr  style="display:table-row;">{% include 'includes/end_date.html'%}</tr>
        <tr  id="data_summ" style="display:table-row;">{% include 'includes/data_summary.html'%}</tr>
        {%if initial.data_summary == "none"%}
        <tr id="temp_summary" style="display:none">{% include 'includes/temporal_summary.html'%}</tr>
        <tr id="spat_summary" style="display:none">{% include 'includes/spatial_summary.html'%}</tr>
        <tr  id="start_wind" style="display:none;">{% include 'includes/start_window.html'%}</tr>
        <tr  id="end_wind" style="display:none;">{% include 'includes/end_window.html'%}</tr>
        {%endif%}
        {%if initial.data_summary == "temporal_summary"%}
        <tr id="temp_summary" style="display:table-row">{% include 'includes/temporal_summary.html'%}</tr>
        <tr id="spat_summary" style="display:none">{% include 'includes/spatial_summary.html'%}</tr>
        <tr  id="start_wind" style="display:none;">{% include 'includes/start_window.html'%}</tr>
        <tr  id="end_wind" style="display:none;">{% include 'includes/end_window.html'%}</tr>
        {%endif%}
        {%if initial.data_summary == "spatial_summary"%}
        <tr id="temp_summary" style="display:none">{% include 'includes/temporal_summary.html'%}</tr>
        <tr id="spat_summary" style="display:table-row">{% include 'includes/spatial_summary.html'%}</tr>
        <tr  id="start_wind" style="display:none;">{% include 'includes/start_window.html'%}</tr>
        <tr  id="end_wind" style="display:none;">{% include 'includes/end_window.html'%}</tr>
        {%endif%}
        {%if initial.data_summary == "windowed_data"%}
        <tr  id="start_wind" style="display:table-row;">{% include 'includes/start_window.html'%}</tr>
        <tr  id="end_wind" style="display:table-row;">{% include 'includes/end_window.html'%}</tr>
        <tr id="temp_summary" style="display:none">{% include 'includes/temporal_summary.html'%}</tr>
        <tr id="spat_summary" style="display:none">{% include 'includes/spatial_summary.html'%}</tr>
        {%endif%}
        {%if initial.data_type == "station" and initial.data_summary == "none"%}
        <tr  id="flags" style="display:table-row">{% include 'includes/show_flags.html'%}</tr>
        <tr  id="obs_time" style="display:table-row">{% include 'includes/show_observation_time.html'%}</tr>
        {%elif initial.data_type == "station" and initial.data_summary == "windowed_data"%}
        <tr  id="flags" style="display:table-row">{% include 'includes/show_flags.html'%}</tr>
        <tr  id="obs_time" style="display:table-row">{% include 'includes/show_observation_time.html'%}</tr>
        {%else%}
        <tr  id="flags" style="display:none">{% include 'includes/show_flags.html'%}</tr>
        <tr  id="obs_time" style="display:none">{% include 'includes/show_observation_time.html'%}</tr>
        {%endif%}
        <tr  style="display:table-row;">{% include 'includes/data_format.html'%}</tr>
        {%if initial.data_format != "html"%}
        <tr id="out_format" class="out_format" style="display:table-row;">{% include 'includes/output_format.html'%}</tr>
        {%else%}
        <tr id="out_format" class="out_format" style="display:none;">{% include 'includes/output_format.html'%}</tr>
        {%endif%}
        {%if initial.data_format == "dlm" or initial.data_format == "clm"%}
        <tr id="delim" class="delim" style="display:table-row;">{% include 'includes/delimiter.html'%}</tr>
        {%else%}
        <tr id="delim" class="delim" style="display:none;">{% include 'includes/delimiter.html'%}</tr>
        {%endif%}
        {%if initial.data_format != "html"%}
            <tr id="out_file" class="out_file" style="display:table-row;">{% include 'includes/out_file.html'%}</tr>
        {%else%}
            <tr id="out_file" class="out_file" style="display:none;">{% include 'includes/out_file.html'%}</tr>
        {%endif%}
        <tr style="display:none;" class="un">{% include 'includes/user_name.html'%}</tr>
        <tr style="display:none;" class="ue">{% include 'includes/user_email.html'%}</tr> 
        </table>
        <input type="hidden" class="overlay_state" name="overlay_state" value="{{initial.overlay_state}}">
        <input type="hidden" name="app_name" value="multi_lister">
        <input class="mainFormSubmit" style="margin:5px" type="submit" value="Get data" name="formData"/>
        </form>
    </div>
</td>
<!--Large Request Form/Errors/Maps-->
<td valign="top" width="60%">
    <!--Large Request Form-->
    <div id="largeRequestForm" style="display:none">
        {% include 'includes/large_request_form.html'%}
    </div>
    <div id="offlineMessage" style="display:none">{% include 'includes/offline_message.html'%}</div>
    {%if large_request%}
       <script type="text/javascript">
            ShowPopupDocu('largeRequestForm');
        </script>
    {%endif%} 

    <!--AJAX error-->
    <div style="display:none" class="ajax_error"></div>


    <!--Shape file upload form-->
    <div>{% include 'includes/upload_shape_file.html'%}</div>

    <!--Request errors-->
    <div class="results" align="center">
    {%if form_error%}
        {% include 'includes/form_error.html'%}
    {%endif%}

    {%if  run_done and not results.data and not results.smry %}
        {% include 'includes/no_results.html'%}
    {%endif%}
    </div> 
    
    <!--Map section-->
    <!--Overlay maps-->
    {%if need_overlay_map%}
        <div id="OverlayMap" style="display:block;">{% include 'includes/overlay_map.html'%}</div>
        <div id="map-overlay"></div>
        <div id="content-window"></div>
        <script type="text/javascript">initialize_map_overlays()</script>
    {%else%}
        <div id="OverlayMap" style="display:none;">{% include 'includes/overlay_map.html'%}</div>
        <div id="map-overlay" style="display:none;"></div>
        <div id="content-window" style="display:none;"></div>
    {%endif%}

    <!--Polygon map-->
    {%if need_polygon_map%}
    <input type="button" id="zoombutton" value="Zoom To" onclick="zoomToLocation()" style="height:21px;">
    <input id="address" type="textbox" value="Place/Location" style="height:15px;width:150px;">
    <div id="PolyMap" style="display:block;">
    <div id="map-polygon" style="display:block;"></div>
    {%if initial.shape%}
        <script type="text/javascript">initialize_polygon_map("{{initial.shape}}");</script>
    {%else%}
        <script type="text/javascript">initialize_polygon_map();</script>
    {%endif%}
    {%else%}
    <input style="display:none;" id="zoombutton" type="button" value="Zoom To" onclick="zoomToLocation()" style="height:21px;">
    <input style="display:none;" id="address" type="textbox" value="Place/Location" style="height:15px;width:150px;">
    <div id="PolyMap" style="display:none;">
    <div id="map-polygon" style="display:none;"></div>
    {%endif%}
        <div id="panel">
        <div id="color-palette"></div>
            <div>
                <button id="delete-button">Delete Selected Shape</button>
            </div>
        </div>
    </div>
    <!--end map section--> 
</td></table>

<!--Results-->
<table cellpadding="10" align="center">
<td valign="top" width="97%" align="center">
    <!--Results-->
    <!--Print and download buttons-->
    <div class="results">
    <!--Data-->
    <table id="printable_table" align="center">
    <td align="center">
    
    {%if results %}
    {%if results.data or results.smry %}
    <div align="left" style="max-width:100%;word-wrap:break-word;">
    {%for key_val in params_display_list%}
        <b>{{key_val.0}}</b>: {{key_val.1}}; 
    {%endfor%}
    </div><br />
    {%endif%}
    {%endif%}
    
    {% if not results.error and results.data and not results.smry %}
    
    {% if initial.data_type == "station" %}
    <p class="message" align="left" style="max-width:70%;word-wrap:break-word;">
        ACIS Data Flags: M,-9999 = Missing, T = Trace, S = Subsequent, A = Accumulated
    </p><br />
    {% endif%}

    <!--lOOP over results-->
    {% for point_data in results.data %}
        <p class="dataTableInfo" id="dataTableInfo-{{forloop.counter0}}" align="left" style="max-width:70%;word-wrap:break-word;"><b>METADATA</b>:<br />
           {% for meta_list in results.meta|lookup:forloop.counter0 %}
                <b>{{meta_list.0}}</b>: {{meta_list.1}}
           {%endfor%}
        </p>
        <table class="dataTable nowrap" id="dataTable-{{forloop.counter0}}" border="1" width="800px">
        {%for data in point_data%}
        {%if forloop.counter0 == 0%}
            <thead>
            <tr>{%for d in data%}<th>{{d}}</th>{%endfor%}</tr>
            </thead>
            <tfoot>
            <tr>{%for d in data%}<th>{{d}}</th>{%endfor%}</tr>
            </tfoot>
            <tbody>
        {%else%}
            <tr>{%for d in data%}<td>{{d}}</td>{%endfor%}</tr>
        {%endif%}
        {%endfor%}
        </tbody>
        </table>
    {% endfor %}

    {%endif%}<!--end if not results.error-->

    {%if not results.error and results.smry%}
        <table class="dataTable" border="1"  width="800px">
        {%for s_data in results.smry%}
        {%if forloop.counter0 == 0%}
             <thead><tr>
            {%for s in s_data%}
                <th>{{s}}</th>
            {%endfor%}
            </tr></thead>
             <tfoot><tr>
            {%for s in s_data%}
                <th>{{s}}</th>
            {%endfor%}
            </tr></tfoot>
        {%else%}
            <tr>
            {%for s in s_data%}
                <td>{{s}}</td>
            {%endfor%}
            </tr>
        {%endif%}
        {%endfor%}
        </tbody>
        </table>
    {%endif%}
    <div><!--end results-->
    
    </td></table><!--End printable table-->
    </div><!--end div data_results-->

</td></table>
{%endblock%}
