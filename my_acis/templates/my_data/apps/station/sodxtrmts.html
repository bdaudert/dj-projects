{% extends "csc_base.html" %}

<meta name="keywords" content="Metadata, graph, coop station, station data, historic data,application, product, tool">
<meta name="description" content="SW-CKN Generates Metadata graph for a coop station">

{%load my_data_filters%}

{% block content %}

<p align="center">You are here
    <a href="{{HOME_URL}}">HOME></a>
    <a href="{{SW_CKN_URL}}main_map/">RESOURCES></a>
    <a href="{{TOOLS_URL}}">TOOLS></a>
    <a href="{{TOOLS_URL}}station/">STATION TOOLS></a> 
    <a href="{{TOOLS_URL}}station/sodxtrmts/">Monthly Summary Time Series from Daily Input</a>
</p>

<div class="container">
    <!--<div class="center-left" style="border:none;">-->
    <table border="0" cellpadding="10">
        <tr valign="top">
        <td>
        <div id='form0'>
            <form method="post" action="">{% csrf_token %}
            <table class="form">
            {%for field in form0 %}
                <!--
                {%if field.label == "base_temperature"%}
                    <tr><td><input type="submit" value="Submit" name="form0"/></td></tr>
                    <!-- Add Extra Options -->
                    <tr><td colspan="3"><hr style="border-color:#006666;"></td></tr>
                    <tr><td colspan="3"><b color="red">Conditional Otional</b></td></tr>
                    <tr><td colspan="3"><hr style="border-color:#006666;"></td></tr>
                {%endif%}

                {%if field_label == "less_greater_or_between"%}
                    <tr><td colspan="3"><hr style="border-color:#006666;"></td></tr>
                    <tr><td colspan="3"><b>Thresholds for "Number of Days" statistic</b></td></tr>
                {%endif%}
                
                {%if field_label == "frequency_analysis_type"%}
                    <tr><td colspan="3"><hr style="border-color:#006666;"></td></tr>
                    <tr><td><b>Frequency Analysis Type</b></td></td></tr>
                {%endif%}
                -->
                    <tr>
                        <td>{{field.label}}:</td>                                                                    
                        <td>{{field}}</td>                                                                                
                        <td><p class="trigger"><img alt="QMark" title="QMark" src="{{MEDIA_URL}}img/QMark.png" class="icon_small"></p>
                        {%ifequal field.label "Monthly Statistic"%}
                            <div class="pop-up"><img alt="AnalysisChoices" title="AnalysisChoices" width="400px" height="300px" src="{{MEDIA_URL}}img/SodxtrmtsAnalysisChoices.png"></div>
                        {%else%}                                             
                            <div class="pop-up"><p>{{field.help_text}}</p></div>
                        {%endifequal%}
                        </td>
                    </tr>
                    {%ifequal field.label "Station id"%}
                        <tr><td></td><td><a target="_blank" href="{{TOOLS_URL}}station/station_finder/">Station Finder</a></td><td></td></tr>
                    {%endifequal%}

               {%if field.errors%}
                 <tr><td></td><td>{{field.errors}}</td><td></td></tr>
                {%endif%}
            {%endfor%}

            <tr><td><input type="submit" value="Submit" name="form0"/></td></tr>
            <!-- Add Extra Options -->
            <tr><td colspan="3"><hr style="border-color:#006666;"></td></tr>
            <tr><td colspan="3"><b color="red">Conditional Otional</b></td></tr>
            <tr><td colspan="3"><hr style="border-color:#006666;"></td></tr>
            <tr><td colspan="3"><b>Base Temperature for Degree Days</b></td></tr>
            <tr>
                <td></td>
                <td><input type="text" name="base_temperature" value=65 ></td>
                <td><p class="trigger"><img alt="QMark" title="QMark" src="{{MEDIA_URL}}img/QMark.png" class="icon_small"></p>
                <div class="pop-up"><p>Base Temperature for Heating/Cooling or Growing Degree Days.</p></div>
            </tr>
            <tr><td colspan="3"><hr style="border-color:#006666;"></td></tr>
            <tr><td colspan="3"><b>Thresholds for "Number of Days" statistic</b></td></tr>
            <tr>
                <td><input type="radio" name="less_greater_or_between" value="l" checked>Less Than</td>
                <td><input type="text" name="less" step="any" value={{less}} ></td>
                <td><p class="trigger"><img alt="QMark" title="QMark" src="{{MEDIA_URL}}img/QMark.png" class="icon_small"></p>
                <div class="pop-up"><p>Count number of days with values less than this threshold.</p></div>
            </tr>
            <tr>               
                <td><input type="radio" name="less_greater_or_between" value="g">Greater Than</td>                
                <td><input type="number" name="greater" step="any" value={{greater}}></td>
                <td><p class="trigger"><img alt="QMark" title="QMark" src="{{MEDIA_URL}}img/QMark.png" class="icon_small"></p>
                <div class="pop-up"><p>Count number of days with values greater than this threshold.</p></div>
            </tr> 
            <tr>                               
                <td><input type="radio" name="less_greater_or_between" value="b">Between</td>
                <td><input type="number" name="threshold_low_for_between" step="any" value={{threshold_low_for_between}}>
                    and<input type="number" name="threshold_high_for_between" step="any" value={{threshold_high_for_between}}>
                </td>
                <td><p class="trigger"><img alt="QMark" title="QMark" src="{{MEDIA_URL}}img/QMark.png" class="icon_small"></p>
                <div class="pop-up"><p>Count number of days with values between these thresholds.</p></div>
            </tr>
            <tr><td colspan="3"><hr style="border-color:#006666;"></td></tr>
            <tr><td><b>Frequency Analysis Type</b></td></td></tr>
            <tr>
                <td><input type="radio" name="frequency_analysis_type" value="p" checked>P III</td>
                <td><input type="radio" name="frequency_analysis_type" value="g">GEV</td>
                <td><p class="trigger"><img alt="QMark" title="QMark" src="{{MEDIA_URL}}img/QMark.png" class="icon_small"></p>
                <div class="pop-up"><p>Frequency Analysis Types: Peasron III, Generalized Extreme Value.</p></div>
            </tr>
            </table>
            <input type="submit" value="Submit" name="form0"/>
            </form>
        </div>
    <!--</div>-->
    </td><td>
    <!--<div class="center" style="border:none;background-color:X^H#947e6e;">-->
        <h2>{{title}}</h2>
        <div id=tool_info_head></div>
        <script type="text/javascript">                        
            $("#tool_info_head").load("{{MEDIA_URL}}html/commons.html .tool_info");
        </script>
        <div id="tool_info" style="display:none;"></div>
        <script type="text/javascript">            
            $("#tool_info").load("{{MEDIA_URL}}html/commons.html #Docu_SODXTRMTS");
        </script>

        <div id="how_to_head"></div>
        <script type="text/javascript">            
            $("#how_to_head").load("{{MEDIA_URL}}html/commons.html .tool_how_to");
        </script>
        <div id="how_to" style="display:none;">
            <p></p>
            <p>Don't know your station id? Find it here:</p>
            <a href="{{TOOLS_URL}}station/station_finder/">STATION FINDER</a><br />
            <p>Define your start and end year. Use "POR" for both start/end year if you are
                        interested in the period of record of the station</p>
            <p>Chose a climate element from the list provided.</p>
            <p>If you chose any of the Degree Day elements, please specify your base temperature.</p>
            <p>The analysis type defines the type of statistics  that will be generated.
            <ul>
                <p>Monthly Maximum --<br /> 
                Computes monthly maximum of the climate element for each month in the period spanning start and end year.<br />
                Monthly Minimum -- <br />
                Computes monthly minimum of the climate element for each month in the period spanning start and end year.<br />
                Monthly Average -- <br />
                Computes monthly average of the climate element for each month in the period spanning start and end year, <br />
                as the sum of the daily non-missing values divided by the number of non-missing values.<br />
                Standard deviation -- <br />
                Compute standard deviation of individual daily values<br />
                of the climate element within each month. Uses N-1 degrees of freedom.<br />
                Number of Days -- <br />
                Computes number of days that daily values of the climate element meet<br />
                user selected threshold criteria for each month in the period spanning the start to end year.<br />
                Range during Month -- <br />
                Computes the difference (Highest minus Lowest daily value) of the selected climate element <br />
                for each month in the period spanning the start to end year.<br />
                Monthly Sum -- <br />
                Computes monthly sum of daily values of the climate element <br />
                for each month in the period spanning the start to end year.</p>
            <ul>
            </p>
            <p>The number of maximum missing days allowed in a month. Months with more than max_missing_days missing
            will be omitted from the analysis.</p>
            <p>Chose a month for the start of your analysis.</p>
            <p>If the option departure from averages is chosen, the results will be returned as departure from averages rather than raw values.</p>
            <p>There is an option to perfom a frequency analysis on the results of the statistical analysis.</p>
            <p>If you opt for a frequency analysis, please choose your analysis type.</p>
            </p>
        </div>
        <br />
        {%if results%}
            <!--Graphics-->
            <p class="pop_link" onClick="ShowHide('range_plot')"><u>Show/hide plot of mean and range</u></p>
            <div id="range_plot" style="display:none;">
                {%if search_params%}
                    {%if station_name%}
                    <p><b>Station Name</b>: {{station_name}}</p>
                    {%endif%}
                    <p class="error"><b>Parameters</b>:</p>
                    <p>
                    {%for key, val in search_params.items%}
                    <b>{{key}}</b>: {{val}}
                    {%endfor%}
                    </p>
                {%endif%}
                <input type="hidden" id="json_file" name="json_file" value="{{json_file}}">
                <input type="hidden" id="JSON_URL" name="JSON_URL" value="{{JSON_URL}}">
                <div id="graph_container" style="height:350px;width:600px;"></div>
                <script type="text/javascript" src="{{ MEDIA_URL }}js/hc-sodxtrmts.js"></script>
                <br / >
            </div>
            <p class="pop_link" onClick="ShowHide('table_header')"><u>Show/hide table header</u></p>
            <div id="table_header" style="display:none;">
                {%if search_params%}
                    {%if station_name%}
                    <p><b>Station Name</b>: {{station_name}}</p>
                    {%endif%}
                    <p class="error"><b>Parameters</b>:</p>
                    <p>
                    {%for key, val in search_params.items%}
                    <b>{{key}}</b>: {{val}}
                    {%endfor%}
                    </p>
                {%endif%}

                <p align="left">
                <b>Missing days allowed</b><br />Any month with less than or equal this user selected number will be included in the analysis.<br /> 
                Monthly information for months with more than this number of missing values will be displayed, but not used. <br />
                The letter indicates the number of missing days <br />
                (a = 1 day missing, b = 2 days missing, f = 6 days missing, z = 26 or more values missing).
                <br /></br />
                <b>Summary Table</b><br />
                <b>Mean</b> – 
                Column mean of all months that meet criteria for number of missing days.<br /> 
                Months with excess missing days not used.<br />
                <b>S.D.</b> – 
                Standard deviation of the column values, using only months that meet criteria for missing days.<br />
                <b>SKW10</b> – 
                Shows skewness coefficient of the values in this column, using only those months that meet criteria for missing data. <br />
                Value is multiplied by 10.<br />
                <b>Max</b> –
                Maximum of column values using only those months that meet missing days criteria.<br />
                <b>Min</b> –
                Minimum of column values using only those months that meet missing days criteria.<br />
                <b>Years</b> –
                Number of years with months that meet criteria for missing days.
                </p>
            </div>
            
            <!-- One tab per element -->
            <img alt="Print" title="Print" class="icon" src="{{MEDIA_URL}}img/Print.png" onClick="printNode('printable_table')">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <a href="{{SW_CKN_URL}}/download/?app_name=Sodxtrmts&json_file={{json_file}}" onClick="return popup_window(this, 'Download Table')">
            <img alt="Download" title="Download" class="icon" src="{{MEDIA_URL}}img/Download.png"></a>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <a target="_blank" href="{{TOOLS_URL}}station/sodxtrmts/visualize/?station_ID={{station_ID}}&element={{element}}&json_file={{json_file}}" style="font-size:large;">Generate Time Series Plots for this data</a>
            
            <table id="printable_table" class="right_aligned" cellpadding="none">
            <tr>
            <td><font size="+2">YEAR</font></td>
            {%for mon in month_list%}
                {%if forloop.last %}
                    <td colspan="2"><font size="+2"></td>
                    <td colspan="2"><font size="+2"></td>
                    <td colspan="2"><font size="+2"></td>
                {%endif%}
                <td colspan="2"><font size="+2">{{mon}}</font></td>
            {%endfor%}
            </tr>
            {%for yr_data in results %}
                {%if yr_data.0 == "MEAN"%}
                    <tr><td></td><td></td></tr>
                    <tr><td></td><td></td></tr>
                    <tr><td></td><td></td></tr>
                    <tr><td></td><td></td></tr>
                    <tr><td></td><td></td></tr>
                    <tr><td></td><td></td></tr>
                {%endif%}
                <tr>
                {%for dat in yr_data%}
                    {%if forloop.revcounter0 == 1%}
                        <td></td><td></td>
                        <td></td><td></td>
                        <td></td><td></td>
                    {%endif%}
                    <td>{{dat}}</td>
                {%endfor%}
                </tr>
            {%endfor%}
            </table>
        {%else%}
            {%if run_done%}
                <p style="color:red">NO STATION DATA FOUND!</p></br>
            {%endif%}
       {%endif%}
    </td></tr>
    </table>
    <!--</div> end center-->

</div>

  <!-- Footer -->
<!--
  <div id="footer" align="center"></div>
    <script type="text/javascript">                        
    $("#footer").load("{{MEDIA_URL}}html/commons.html .footer-partners");
    </script>
-->
{%endblock%}
